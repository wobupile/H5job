<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #canvas{
            background:url('H5img/jinqiu.jpg') no-repeat;
            background-size: 216px 162px;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="432" height="162" ></canvas>
</body>
<script>
    //绘制覆盖图层，原图以透明形式
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    context.fillStyle='gray';
    context.fillRect(0,0,216,162);
    context.fill();
    context.globalCompositeOperation = 'destination-out';

    var decision;
    //定义事件
    canvas.onmousedown=function(dot){
        dot.preventDefault();
        decision = true;
    }
    //取消事件
    canvas.onmouseup = function(dot){
        dot.preventDefault();
        decision = false;
        distinct();
    }
    //绘画点击透明图层
    canvas.onmousemove = function(dot){
        dot.preventDefault();
        if(decision){
            var x = (dot.clientX+document.body.scrollLeft)-canvas.offsetLeft || 0;
            var y = (dot.clientY+document.body.scrollTop)-canvas.offsetTop || 0;            
            context.beginPath();
            context.arc(x,y,20,0,Math.PI*2);
            context.fill();
            context.closePath();
        }
        distinct();
        
    }
    //百分之85清楚覆盖图层实现

    function distinct(){
        var n = context.getImageData(0,0,216,162).data;
        var con = 0;
        for(var i = 0;i< n.length;i +=4){
            var al= n[i+3];
            if(al < 10){
                con++;
            }
        }
        var cons = con /(n.length/4);
        if(cons>0.70){//老师 我这个设成0.85效果不明显 我就设成0.7了哈
            context.clearRect(0,0,216,162);
        }
    }

    // // canvas.addEventListener('touchend',function(){
	// 				var imgdatga=ctx.getImageData(0,0,canvas.width,canvas.height);
	// 				//拿到所有的像素
	// 				var allPx=imgdatga.width*imgdatga.height;
					
	// 				for(var i=0;i<allPx;i++){
	// 				    if(imgdatga.data[4*i+3]==0){
	// 				    	flag++;
	// 				    }
	// 				}
	// 				//如果划开的像素大于整个canvas的一半，就让canvas的透明度为0，让图片显示出来
	// 				if(flag>=allPx/2){
	// 					canvas.style.opacity=0;
	// 				}
	// 				//过渡执行完，透明度为0，就把canvas在页面上删除
	// 				canvas.addEventListener('transitionend',function(){				
	// 						this.remove();//删除canvas
	// 				});
//     var data = imgData.data; //得到像素的字节数据
// 	var length = data.length; //获取该数据的长度
// 	var transparent = 0; //设置一个变量来记录已经变为透明的像素点的数量
// 	for (var i = 0; i < length; i += 4) { //循环遍历每一个像素
// 		var alpha = data[i + 3]; //获取每个像素的透明度数值
// 		if (alpha < 10) //当透明度小于10时，认为它已经被擦除，transparent数值加1
// 			transparent++;
// 	}
// 	var percentage = transparent / (length / 4); //计算透明像素在所有像素点中所占比例
// 	if (percentage > 0.9) //当比例大于90%时，显示刮奖结束字样
// 		alert("刮奖结束！");
// }
</script>
</html>
